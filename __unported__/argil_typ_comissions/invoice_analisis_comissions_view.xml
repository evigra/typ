<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

            <!-- ============ SECUENCIAS =========== -->

        <record id="sequence_invoice_comission_report" model="ir.sequence.type">
            <field name="name">Secuencia Reporte Comisiones</field>
            <field name="code">invoice.comission.report</field>
        </record>

        <record id="sequence_invoice_comission_report_def" model="ir.sequence">
            <field name="name">Secuencia Reporte Comisiones</field>
            <field name="code">invoice.comission.report</field>
            <field name="prefix">CR-</field>
            <field name="padding">5</field>
            <field name="implementation">no_gap</field>
        </record>
    
    <!-- == CARGAR EL REPORTE JASPER DESDE EL MODULO MEDIANTE UN BOTON ACTION === -->


    <!--============================TREE VIEW================================-->
        <record id="invoice_comission_report_tree" model="ir.ui.view">
          <field name="name">invoice.comission.report.tree</field>
          <field name="model">invoice.comission.report</field>
          <field name="type">tree</field>
          <field name="priority" eval="5"/>
          <field name="arch" type="xml">
            <tree string="Invoices Comissions Report">
                <field name="name"/>
                <field name="user_id" />
                <field name="date_start" />
                <field name="date_end" />
                <field name="notes" />
                <field name="total_comission_generate" string="Comission Total"/>
                <field name="date" invisible="1"/>
                <field name="company_id" invisible="1"/>
            </tree>
          </field>
        </record>

        <!--====================================FORM VIEW================================-->
        <record model="ir.ui.view" id="invoice_comission_report_form">
          <field name="name">invoice.comission.report.form</field>
          <field name="model">invoice.comission.report</field>
          <field name="type">form</field>
          <field name="priority" eval="5"/>
          <field name="arch" type="xml">
            <form string="Invoices Comissions Report" version="7.0">
                <header>
                    <button name="print_report" string="Print Report" icon="gtk-execute"  type="object" class="oe_highlight"/>
                </header>
                <sheet>
                    <group colspan="4">
                        <h1>
                            <label string="Invoice Comission Report"/>
                            <field name="name" class="oe_inline" readonly="1"/>
                        </h1>
                    </group>
                    <group col="4">
                        <newline />
                        <field name="user_id" readonly="1" />
                        <field name="company_id" readonly="1"/>
                        <newline/>
                        <field name="date" readonly="1" />
                        <newline />
                        <separator string="Period" />
                        <newline/>
                        <field name="date_start"  readonly="1" />
                        <field name="date_end"  readonly="1" />

                    </group>
                    <notebook colspan="4">
                        <page string="Comisiones de Facturas" >
                            <field name="report_lines" readonly="1" >
                                <tree string="Invoices Details" >
                                    <field name="invoice_id" />
                                    <field name="partner_id" />
                                    <field name="origin" />
                                    <field name="date_invoice" />
                                    <field name="amount_payment" string="Subtotal Factura"/>
                                    <field name="payment_days" />
                                    <field name="date_payment_real" />
                                    <!-- <field name="margin_percentage" /> -->
                                    <!-- <field name="percentage" /> -->
                                    <field name="comission" />
                                </tree>
                                <form string="Detalle de las Facturas" version="7.0">
                                    <sheet>
                                        <group col="4">
                                            <field name="invoice_id" />
                                            <field name="partner_id" />
                                            <field name="origin" />
                                            <field name="date_invoice" />
                                            <field name="amount_payment" />
                                            <field name="payment_days" />
                                            <!-- <field name="margin_percentage" /> -->
                                            <!-- <field name="percentage" /> -->
                                            <field name="comission" />
                                        </group>
                                        <h3>Detalle de la Comision</h3>
                                        <field name="invoice_line_detail_ids" >
                                            <tree string="Lineas de Factura" editable="bottom">
                                                <field name="line_id" />
                                                <field name="product_id" />
                                                <field name="subtotal_cost" />
                                                <field name="subtotal_line" />
                                                <field name="margin_percentage" />
                                                <field name="margin_amount" />
                                                <field name="percentage_comission" />
                                                <field name="amount_comission" />
                                                <!-- <field name="notes" /> -->
                                            </tree>
                                        </field>
                                    </sheet>
                                </form>
                            </field>
                            <group class="oe_subtotal_footer oe_right" colspan="2" name="total_comission_generate">
                                <field name="total_comission_generate"  widget='monetary' options="{'currency_field': 'currency_id'}"/>
                            </group>
                            <newline />
                            <newline />
                            <separator string="" />
                        </page>
                        <!-- <page string="Others">
                        </page> -->
                        <page string="Notes">
                            <separator string="Bitacora" readonly="1" />
                            <field name="log" />
                            <separator string="Notas" />
                            <field name="notes" nolabel="1" widget="html"/>

                        </page>
                    </notebook>
                    
                </sheet>

            </form>
          </field>
        </record>


        <record id="invoice_comission_report_filter" model="ir.ui.view">
          <field name="name">invoice.comission.report.filter</field>
          <field name="model">invoice.comission.report</field>
          <field name="type">search</field>
          <field name="priority" eval="5"/>
          <field name="arch" type="xml">
            <search string="Invoices Comissions Report Search">
                <field name="name"/>
                <field name="user_id" />
                <field name="date" />
                <field name="date_start" />
                <field name="date_end" />
                <field name="company_id"/>
                <group expand="0" string="Group By...">
                    <filter string="Company" domain="[]" context="{'group_by':'company_id'}"/>
                    <filter string="Salesman" domain="[]" context="{'group_by':'user_id'}"/>
                    <filter string="Date" domain="[]" context="{'group_by':'date'}"/>
                    <filter string="Date Start" domain="[]" context="{'group_by':'date_start'}"/>
                    <filter string="Date End" domain="[]" context="{'group_by':'date_end'}"/>
                </group> 
            </search>
          </field>
        </record>

        <!--====================================ACTIONS================================-->
        <record model="ir.actions.act_window" id="action_invoice_comission_report">
            <field name="name">Historial de Comisiones</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">invoice.comission.report</field>
            <field name="search_view_id" ref="invoice_comission_report_filter"/>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>
            <!--====================================MENU================================-->

        <menuitem action="action_invoice_comission_report" id="menu_invoice_comission_report" parent="menu_reports_pssoft" sequence="2"/>

    </data>
</openerp>