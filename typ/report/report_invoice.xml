<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="assets_common_l10n_mx_edi_typ" inherit_id="web.report_assets_pdf">
        <xpath expr="." position="inside">
            <link href="/l10n_mx_edi/static/src/less/report.less" rel="stylesheet" type="text/less"/>
        </xpath>
    </template>
    <template id="custom_external_layout_standard">
        <div class="header">
        </div>
        <div class="article o_report_layout_standard">
            <t t-raw="0" />
        </div>
    </template>

    <template id="custom_external_layout">
        <!-- Multicompany -->
        <t t-if="not o and doc">
            <t t-set="o" t-value="doc"/>
        </t>
        <t t-if="o and 'company_id' in o">
            <t t-set="company" t-value="o.company_id.sudo()"/>
        </t>
        <t t-if="not o or not 'company_id' in o">
            <t t-set="company" t-value="res_company"/>
        </t>
        <t t-call="typ.custom_external_layout_standard"><t t-raw="0"/></t>
    </template>

    <!-- QWeb Reports -->
    <record id="account.account_invoices" model="ir.actions.report">
        <field name="paperformat_id" ref="typ.typ_paperformat_invoice_letter"/>
    </record>

    <record id="account.account_invoices_without_payment" model="ir.actions.report">
        <field name="paperformat_id" ref="typ.typ_paperformat_invoice_letter"/>
    </record>

    <template id="report_invoice_document_typ" inherit_id="account.report_invoice_document">
        <xpath expr="//t[@t-call='web.external_layout']" position="attributes">
            <attribute name="t-call">typ.custom_external_layout</attribute>
        </xpath>
        <xpath expr="//div[1]" position="before">
            <t t-if="o.l10n_mx_edi_cfdi_uuid">
                <!--New global variables-->
                <t t-set="xml" t-value="o.l10n_mx_edi_get_xml_etree()"/>
                <t t-set="tfd" t-value="o.l10n_mx_edi_get_tfd_etree(xml)"/>
                <t t-set="tfd_original_string" t-value="o._get_l10n_mx_edi_cadena()"/>
            </t>
        </xpath>
        <xpath expr="//div[hasclass('row')]" position="replace">
        </xpath>
        <xpath expr="//h2" position="replace">
            <div class="row">
                <div class="col-xs-3" style="margin: 0px; padding: 0px;">
                    <img t-if="o.company_id.logo" t-att-src="'data:image/png;base64,%s' % to_text(o.company_id.logo)" style="max-height: 60px;"/>
                </div>
                <div class="col-xs-offset-3 col-xs-6 text-right">
                    <div class="row" style="font-size: 12;">
                        <div class="col-xs-4 text-center bg-primary" style="border-top-left-radius: 0.4em; padding-top: 0.0em;">
                            <span t-if="o.type == 'out_invoice' and (o.state == 'open' or o.state == 'paid')">Invoice</span>
                            <span t-if="o.type == 'out_invoice' and o.state == 'draft'">Draft Invoice</span>
                            <span t-if="o.type == 'out_invoice' and o.state == 'cancel'">Cancelled Invoice</span>
                            <span t-if="o.type == 'out_refund'">Credit Note</span>
                            <span t-if="o.type == 'in_refund'">Vendor Credit Note</span>
                            <span t-if="o.type == 'in_invoice'">Vendor Bill</span>
                        </div>
                        <div class="col-xs-8 text-center bg-primary" style="border-top-right-radius: 0.4em; padding-top: 0.0em;">
                            <span>Document Date</span>
                        </div>
                    </div>
                    <div class="row" style="border: 2px solid #deeff5; border-bottom-left-radius: 0.4em; border-bottom-right-radius: 0.4em;">
                        <div class="col-xs-4 text-center" style="padding-top: 0.0em; border-right: 2px solid #deeff5;">
                            <h4 style="color:red;">
                                <t>
                                    <strong t-esc="o.number"/>
                                </t>
                            </h4>
                        </div>
                        <div class="col-xs-8 text-center" style="padding-top: 1.0em; font-size: 10;">
                            <t t-if="o.l10n_mx_edi_cfdi_uuid">
                                <t t-set="date" t-value="xml.get('Fecha')"/>
                                <span t-esc="o.l10n_mx_edi_cfdi_uuid and time.strftime('%d/%m/%Y %H:%M:%S', time.strptime(date, '%Y-%m-%dT%H:%M:%S')) or 'o.date_invoice'"/>
                            </t>
                            <t t-if="not o.l10n_mx_edi_cfdi_uuid">
                                <span t-esc="o.date_invoice"/>
                            </t>
                        </div>
                    </div>
                </div>
            </div>
            <t t-if="not o.l10n_mx_edi_cfdi_uuid and o.l10n_mx_edi_is_required()">
                <div class="btn btn-danger">
                    <h1>A signature of this invoice is required, but it is not signed.</h1>
                </div>
            </t>
            <div class="row" style="padding-top: 0.5em; font-size: 12;">
                <div class="col-xs-5" style="padding-left: 0.0em; padding-right: 0.2em;">
                    <div class="text-center bg-primary" style="border-top-t-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                        <span>Client Reference</span>
                    </div>
                </div>
                <div class="col-xs-3" style="padding-right: 0.2em; padding-left: 0.2em;">
                    <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                        <span>Fiscal Regime</span>
                    </div>
                </div>
                <div class="col-xs-2" style="padding-right: 0.0em; padding-left: 0.2em;">
                    <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                        <span>Type Payment Term</span>
                    </div>
                </div>
                <div class="col-xs-2" style="padding-right: 0.0em; padding-left: 0.2em;">
                    <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                        <span>Payment Term</span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div>
                    <div class="col-xs-5" style="padding-left: 0.0em; padding-right: 0.2em;">
                        <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em; font-size: 10;">
                            <span t-esc="o.name"/>
                        </div>
                    </div>
                    <div class="col-xs-3" style="padding-right: 0.2em; padding-left: 0.2em;">
                        <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em; font-size: 10;">
                            <t t-if="o.l10n_mx_edi_cfdi_uuid">
                                <span t-esc="xml.Emisor.get('RegimenFiscal')"/>
                            </t>
                        </div>
                    </div>
                    <div class="col-xs-2" style="padding-right: 0.0em; padding-left: 0.2em;">
                        <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em; font-size: 10;">
                            <span t-field="o.type_payment_term"/>
                        </div>
                    </div>
                    <div class="col-xs-2" style="padding-right: 0.0em; padding-left: 0.2em;">
                        <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em; font-size: 10;">
                            <span t-field="o.payment_term_id"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row" style="padding-top: 0.5em; font-size: 12;">
                <div>
                    <div class="col-xs-4" style="padding-right: 0.2em; padding-left: 0.0em;">
                        <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                            <span>Issuer</span>
                        </div>
                    </div>
                    <div class="col-xs-4" style="padding-right: 0.0em; padding-left: 0.2em;">
                        <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                            <span>Customer</span>
                        </div>
                    </div>
                    <div class="col-xs-4" style="padding-right: 0.0em; padding-left: 0.2em;">
                        <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                            <span>Issued at</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div style="font-size: 10;">
                    <div class="col-xs-4" style="padding-right: 0.2em; padding-left: 0.0em;">
                        <div class="text-left" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em;">
                            <div>
                                <t t-if="o.l10n_mx_edi_cfdi_uuid">
                                     <strong t-esc="xml.Emisor.get('Nombre', '')"/>
                                </t>
                                <t t-if="not o.l10n_mx_edi_cfdi_uuid">
                                     <strong t-esc="o.company_id.name"/>
                                </t>
                            </div>
                            <div>
                                <span t-esc="o.company_id.street_name"/>
                                <span t-esc="o.company_id.street_number"/>
                                <span t-esc="o.company_id.street2"/>
                                <br/>
                                <span t-esc="o.company_id.l10n_mx_edi_colony"/>
                                <span t-esc="o.company_id.zip"/>
                                <br/>
                                <span t-esc="o.company_id.l10n_mx_edi_locality"/>
                                <br/>
                                <span t-esc="o.company_id.city"/>
                                <span t-esc="o.company_id.state_id.name"/>
                                <span t-esc="o.company_id.country_id.name"/>
                            </div>
                            <div>
                                 <strong t-esc="('RFC. %s') % o.l10n_mx_edi_cfdi_supplier_rfc"/>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-4" style="padding-right: 0.0em; padding-left: 0.2em;">
                        <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em;">
                            <div>
                                <t t-if="o.l10n_mx_edi_cfdi_uuid">
                                     <strong t-esc="xml.Receptor.get('Nombre', '')"/>
                                </t>
                                <t t-if="not o.l10n_mx_edi_cfdi_uuid">
                                     <strong t-esc="o.partner_id.name"/>
                                </t>
                            </div>
                            <div>
                                <span t-esc="o.partner_id.street_name"/>
                                <span t-esc="o.partner_id.street_number"/>
                                <span t-esc="o.partner_id.street2"/>
                                <br/>
                                <span t-esc="o.partner_id.l10n_mx_edi_colony"/>
                                <span t-esc="o.partner_id.zip"/>
                                <br/>
                                <span t-esc="o.partner_id.l10n_mx_edi_locality"/>
                                <br/>
                                <span t-esc="o.partner_id.city"/>
                                <span t-esc="o.partner_id.state_id.name"/>
                                <span t-esc="o.partner_id.country_id.name"/>
                            </div>
                            <br/>
                            <div>
                                <strong t-esc="('RFC. %s') % o.l10n_mx_edi_cfdi_customer_rfc"/>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-4" style="padding-right: 0.0em; padding-left: 0.2em;">
                        <div class="text-right" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em;">
                            <div>
                                <t t-if="o.l10n_mx_edi_cfdi_uuid">
                                     <strong t-esc="xml.Emisor.get('Nombre', '')"/>
                                </t>
                                <t t-if="not o.l10n_mx_edi_cfdi_uuid">
                                     <strong t-esc="o.company_id.name"/>
                                </t>
                            </div>
                            <div>
                                <span t-esc="o.journal_id.l10n_mx_address_issued_id.street_name"/>
                                <span t-esc="o.journal_id.l10n_mx_address_issued_id.street_number"/>
                                <span t-esc="o.journal_id.l10n_mx_address_issued_id.street2"/>
                                <br/>
                                <span t-esc="o.journal_id.l10n_mx_address_issued_id.l10n_mx_edi_colony"/>
                                <span t-esc="o.journal_id.l10n_mx_address_issued_id.zip"/>
                                <br/>
                                <span t-esc="o.journal_id.l10n_mx_address_issued_id.l10n_mx_edi_locality"/>
                                <br/>
                                <span t-esc="o.journal_id.l10n_mx_address_issued_id.city"/>
                                <span t-esc="o.journal_id.l10n_mx_address_issued_id.state_id.name"/>
                                <span t-esc="o.journal_id.l10n_mx_address_issued_id.country_id.name"/>
                            </div>
                            <div>
                                <span t-esc="o.journal_id.l10n_mx_address_issued_id.phone"/>
                            </div>
                            <br/>
                            <br/>
                        </div>
                    </div>
                </div>
            </div>
        </xpath>
        <xpath expr="//table" position="replace">
            <div class="row" style="font-size:10px; padding-top: 0.5em;">
                <div class="col-xs-1 text-center bg-primary">
                    <span>Quantity</span>
                </div>
                <t t-if="o.l10n_mx_edi_cfdi_uuid and xml.get('Version')">
                    <div class="col-xs-1 text-center bg-primary">
                        <span>Unit</span>
                    </div>
                    <div class="col-xs-1 text-center bg-primary">
                        <span>SAT Key</span>
                    </div>
                </t>
                <div class="col-xs-5 text-center bg-primary">
                    <span>Description</span>
                </div>
                <div class="col-xs-2 text-center bg-primary">
                    <span>Unit Price</span>
                </div>
                <div class="col-xs-2 text-center bg-primary">
                    <span>Amount</span>
                </div>
            </div>
            <div class="row">
                <table class="table table-striped" style="font-size:9px; border-collapse: collapse;">
                    <t t-foreach="o.invoice_line_ids" t-as="l">
                        <tr class="text-center">
                            <td class="col-xs-1 text-right"><span t-field="l.quantity"/></td>
                            <td class="col-xs-1 text-left" t-if="o.l10n_mx_edi_cfdi_uuid and xml.get('Version')"><span t-field="l.uom_id.l10n_mx_edi_code_sat_id.code"/></td>
                            <td class="col-xs-1 text-left" t-if="o.l10n_mx_edi_cfdi_uuid and xml.get('Version')"><span t-field="l.product_id.l10n_mx_edi_code_sat_id.code"/></td>
                            <td class="col-xs-5 text-left"><span t-field="l.name"/>
                                <t t-if="l.l10n_mx_edi_customs_number">
                                 <br/>
                                 <i>Customs:</i>
                                    <ul>
                                        <t t-foreach="l.l10n_mx_edi_customs_number.split(',') if l.l10n_mx_edi_customs_number else []" t-as="pedimento">
                                            <li><span t-esc="pedimento"/></li>
                                        </t>
                                    </ul>
                                </t>
                            </td>
                            <td class="col-xs-2 text-right"><span t-field="l.price_unit"/></td>
                            <td class="col-xs-2 text-right" id="subtotal">
                                <span t-field="l.price_subtotal"
                                    t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                            </td>
                        </tr>
                    </t>
                </table>
            </div>
        </xpath>
        <xpath expr="//div[hasclass('clearfix')]" position="replace">
            <div id="total" class="row">
                <div class="row col-xs-offset-9 col-xs-3">
                    <table class="col-xs-12" style="font-size:10px">
                        <tr>
                            <th class="text-left" style="border-top: solid 1.5px #5689bc;"><span>Sub Total</span></th>
                            <td class="text-right" style="border-top: solid 1.5px #5689bc;"><span t-field="o.amount_untaxed" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/></td>
                        </tr>
                        <t t-foreach="o._get_tax_amount_by_group()" t-as="amount_by_group">
                            <tr>
                                <t t-if="len(o.tax_line_ids) == 1 and o.amount_untaxed == amount_by_group[2]">
                                    <td class="text-left" style="border-top: solid 1.5px #5689bc;">
                                        <span t-esc="amount_by_group[0]"/>
                                    </td>
                                    <td class="text-right" style="border-top: solid 1.5px #5689bc;">
                                        <span t-esc="amount_by_group[3]" />
                                    </td>
                                </t>
                                <t t-else="">
                                    <td class="text-left" style="border-top: solid 1.5px #5689bc;">
                                        <span t-esc="amount_by_group[0]"/>
                                        <span>&amp;nbsp;<span>on</span>
                                            <t t-esc="amount_by_group[4]"/>
                                        </span>
                                    </td>
                                    <td class="text-right" style="border-top: solid 1.5px #5689bc;">
                                        <span t-esc="amount_by_group[3]"/>
                                    </td>
                                </t>
                            </tr>
                        </t>
                        <tr align="left">
                            <th class="text-left" style="border-top: solid 1.5px #5689bc;"><b><span>Total</span></b></th>
                            <td class="text-right" align="right" style="border-top: solid 1.5px #5689bc;"><b><span t-field="o.amount_total" t-options='{"widget": "monetary", "display_currency": o.currency_id}'/></b></td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="row" style="font-size: 10;">
                <div class="col-xs-12">
                    <span>Amount In Letters</span>
                </div>
                <div class="col-xs-12 text-center">
                    <span t-esc="o.l10n_mx_edi_amount_to_text()"/>
                </div>
                <div class="col-xs-12">
                    <p class="text-center">Deadline for returns of 15 calendar days from delivery. Product must be presented in original packaging. Warranties: American 1 year parts and 5 years compressor equipment. Asia 1 year parts and compressor equipment. Does not apply to equipment with power failures or burns.</p>
                    <t t-if="o.comment">
                        <p><strong>Notes</strong>: <span t-esc="o.comment"/></p>
                    </t>
                </div>
            </div>
        </xpath>
        <xpath expr="//p[@t-if='o.payment_term_id']" position="replace">
            <t t-if="o.l10n_mx_edi_cfdi_uuid">
                <div class="row" style="padding-top: 0.5em; font-size: 12;">
                    <div class="col-xs-4" style="padding-left: 0.0em; padding-right: 0.2em;">
                        <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                            <span>Fiscal Folio</span>
                        </div>
                    </div>
                    <div class="col-xs-4" style="padding-right: 0.2em; padding-left: 0.2em;">
                        <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                            <span>Account Last 4 Numbers</span>
                        </div>
                    </div>
                    <div class="col-xs-4" style="padding-right: 0.0em; padding-left: 0.2em;">
                        <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                            <span>Issuer Certificate</span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div>
                        <div class="col-xs-4" style="padding-left: 0.0em; padding-right: 0.2em;">
                            <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em; font-size: 10;">
                                <span t-esc="tfd.get('UUID', 'No identificado')"/>
                            </div>
                        </div>
                        <div class="col-xs-4" style="padding-right: 0.2em; padding-left: 0.2em;">
                            <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em; font-size: 10;">
                                <t t-set="bank" t-value="o.l10n_mx_edi_partner_bank_id"/>
                                <span t-esc="bank and bank.acc_number[-4:] or 'No identificado'"/>
                            </div>
                        </div>
                        <div class="col-xs-4" style="padding-right: 0.0em; padding-left: 0.2em;">
                            <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em; font-size: 10;">
                                <span t-esc="xml.get('NoCertificado', 'No identificado')"/>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="padding-top: 0.5em; font-size: 12;">
                    <div>
                        <div class="col-xs-4" style="padding-left: 0.0em; padding-right: 0.2em;">
                            <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                                <span>Form of Payment</span>
                            </div>
                        </div>
                        <div class="col-xs-4" style="padding-left: 0.2em; padding-right: 0.2em;">
                            <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                                <span>Date Stamp</span>
                            </div>
                        </div>
                        <div class="col-xs-4" style="padding-left: 0.2em; padding-right: 0.0em;">
                            <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                                <span>SAT Certificate</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div>
                        <div class="col-xs-4" style="padding-left: 0.0em; padding-right: 0.2em;">
                            <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em; font-size: 10;">
                                <t t-if="o.l10n_mx_edi_payment_method_id">
                                    <span t-esc="' - '.join([o.l10n_mx_edi_payment_method_id.code, o.l10n_mx_edi_payment_method_id.name])"/>
                                </t>
                            </div>
                        </div>
                        <div class="col-xs-4" style="padding-left: 0.2em; padding-right: 0.2em;">
                            <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em; font-size: 10;">
                                <span t-esc="time.strftime('%d/%m/%Y %H:%M:%S', time.strptime(tfd.get('FechaTimbrado'), '%Y-%m-%dT%H:%M:%S')) or 'No identificado'"/>
                            </div>
                        </div>
                        <div class="col-xs-4" style="padding-left: 0.2em; padding-right: 0.0em;">
                            <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em; font-size: 10;">
                                <span t-esc="tfd.get('NoCertificadoSAT', 'No identificado')"/>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" style="padding-top: 0.5em; font-size: 12;">
                    <div class="col-xs-6" style="padding-left: 0.0em; padding-right: 0.2em;">
                        <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                            <span>Payment Method</span>
                        </div>
                    </div>
                    <div class="col-xs-6" style="padding-right: 0.2em; padding-left: 0.2em;">
                        <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                            <span>Use</span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div>
                        <div class="col-xs-6" style="padding-left: 0.0em; padding-right: 0.2em;">
                            <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em; font-size: 10;">
                                    <t t-if="xml.get('formaDePago', xml.get('MetodoPago')) == 'PPD'">
                                        <span> PPD Payment in partials or deferred</span>
                                    </t>
                                    <t t-if="xml.get('formaDePago', xml.get('MetodoPago')) == 'PUE'">
                                        <span> PUE Payment in single exhibition</span>
                                    </t>
                                    <t t-if="xml.get('formaDePago', xml.get('MetodoPago')) not in ['PUE', 'PPD']">
                                        <span t-esc="xml.get('formaDePago', xml.get('MetodoPago'))"/>
                                    </t>
                            </div>
                        </div>
                        <div class="col-xs-6" style="padding-left: 0.2em; padding-right: 0.2em;">
                            <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em; font-size: 10;">
                                <t t-if="xml.Receptor.get('UsoCFDI', False)">
                                    <t t-set="usage" t-value="xml.Receptor.get('UsoCFDI')"/>
                                    <span t-esc="usage"/> - <span t-field="o.l10n_mx_edi_usage"/>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
                <div t-if="o.l10n_mx_edi_origin" class="row" style="padding-top: 0.5em; font-size: 12;">
                    <div class="col-xs-6" style="padding-left: 0.0em; padding-right: 0.2em;">
                        <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                            <span>Related CFDI</span>
                        </div>
                    </div>
                    <div class="col-xs-6" style="padding-right: 0.2em; padding-left: 0.2em;">
                        <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                            <span>Related type</span>
                        </div>
                    </div>
                </div>
                <div t-if="o.l10n_mx_edi_origin" class="row">
                    <div>
                        <div class="col-xs-6" style="padding-left: 0.0em; padding-right: 0.2em;">
                            <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em; font-size: 10;">
                                <t>
                                    <span t-esc="o.l10n_mx_edi_origin[3:]"/>
                                </t>
                            </div>
                        </div>
                        <div class="col-xs-6" style="padding-left: 0.2em; padding-right: 0.2em;">
                            <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em; font-size: 10;">
                                <t>
                                    <t t-if="o.l10n_mx_edi_origin[:2] == '01'">
                                        <span>01 Credit note of related documents</span>
                                    </t>
                                    <t t-if="o.l10n_mx_edi_origin[:2] == '02'">
                                        <span>02 Debit note of related documents</span>
                                    </t>
                                    <t t-if="o.l10n_mx_edi_origin[:2] == '03'">
                                        <span>03 Return of merchandise on previous invoices or transfers</span>
                                    </t>
                                    <t t-if="o.l10n_mx_edi_origin[:2] == '04'">
                                        <span>04 Replacement of previous CFDI</span>
                                    </t>
                                    <t t-if="o.l10n_mx_edi_origin[:2] == '05'">
                                        <span>05 Transfers of goods previously invoiced</span>
                                    </t>
                                    <t t-if="o.l10n_mx_edi_origin[:2] == '06'">
                                        <span>06 Invoice generated by previous transfers</span>
                                    </t>
                                    <t t-if="o.l10n_mx_edi_origin[:2] == '07'">
                                        <span>07 CFDI by advance application</span>
                                    </t>
                                    <t t-if="o.l10n_mx_edi_origin[:2] == '08'">
                                        <span>08 Invoice generated by partial payments</span>
                                    </t>
                                    <t t-if="o.l10n_mx_edi_origin[:2] == '09'">
                                        <span>09 Invoice generated by deferred payments</span>
                                    </t>
                                    <t t-else="">
                                        <span></span>
                                    </t>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" id="complement" style="padding-top: 0.5em;">
                    <div class="col-xs-12 img-rounded" style="page-break-inside:avoid; border: 2px solid #deeff5;">
                        <div class="barcode col-xs-3">
                            <t t-set="sello" t-value="xml.get('Sello', 'No identificado')[-8:]"/>
                            <img t-if="o.partner_id.vat=='CCF941117QG9'" t-att-src="'/report/barcode/?type=QR&amp;value=%s' % quote_plus(
                                'https://verificacfdi.facturaelectronica.sat.gob.mx/default.aspx?id=%s&amp;re=%s&amp;rr=%s&amp;tt=%s&amp;fe=%s' %
                                    (o.l10n_mx_edi_cfdi_uuid, o.l10n_mx_edi_cfdi_supplier_rfc, o.l10n_mx_edi_cfdi_customer_rfc, o.l10n_mx_edi_cfdi_amount,
                                quote_plus(sello, 'utf-8', 'strict', '=/').replace('%2B', '+')))"/>
                            <img t-else="" t-att-src="'/report/barcode/?type=QR&amp;value=%s' % quote_plus(
                                'https://verificacfdi.facturaelectronica.sat.gob.mx/default.aspx?' + keep_query(
                                    re=o.l10n_mx_edi_cfdi_supplier_rfc, rr=o.l10n_mx_edi_cfdi_customer_rfc,
                                    tt=o.l10n_mx_edi_cfdi_amount, id=o.l10n_mx_edi_cfdi_uuid)
                                    + '&amp;fe=%s' % quote_plus(sello, 'utf-8', 'strict', '=/').replace('%2B', '+'))"/>
                        </div>
                        <div class="complement-details col-xs-9">
                            <div class="digital-stamp">
                                <span>Digital stamp of the emitter</span>
                            </div>
                            <div class="digital-stamp-content">
                                <span t-esc="xml.get('sello', xml.get('Sello', 'No identificado'))"/>
                            </div>
                            <div class="digital-stamp">
                                <span>Digital stamp SAT</span>
                            </div>
                            <div class="digital-stamp-content">
                                <span t-esc="tfd.get('selloSAT', tfd.get('SelloSAT', 'No identificado'))"/>
                            </div>
                            <div class="digital-stamp">
                                <span>Original chain complement of digital certification SAT</span>
                            </div>
                            <div class="digital-stamp-content">
                                <span class="nowrap" t-esc="tfd_original_string"/>
                            </div>
                            <div t-if="xml.Emisor.xpath('cfdi:ExpedidoEn', namespaces=xml.nsmap)" class="digital-stamp">
                                <span>Issued from</span>
                            </div>
                            <div t-if="xml.Emisor.xpath('cfdi:ExpedidoEn', namespaces=xml.nsmap)" class="digital-stamp-content">
                                <span t-esc="' | '.join([ '%s: %s' % (key, value) for key, value in xml.Emisor.ExpedidoEn.items()])"/>
                            </div>
                            <div class="digital-stamp">
                                <span>Extra Info</span>
                            </div>
                            <div class="digital-stamp-content">
                                <span>Emitter certificate:</span> <span t-esc="xml.get('noCertificado', xml.get('NoCertificado'))"/>
                                <span> | Expedition place:</span> <span t-esc="xml.get('LugarExpedicion')"/>
                                <span> | Fiscal Regime:</span>
                                    <t t-if="xml.get('version', '') == '3.2'"> <span t-esc="xml.Emisor.RegimenFiscal.get('Regimen')"/></t>
                                    <t t-if="xml.get('Version', '') == '3.3'"> <span t-esc="xml.Emisor.get('RegimenFiscal', '')"/></t>
                                <span> | Emission Date:</span> <span t-esc="xml.get('fecha', xml.get('Fecha', '')).replace('T', ' ')"/>
                                <span> | Certification Date:</span> <span t-esc="tfd.get('FechaTimbrado', '').replace('T', ' ')"/>
                                <span> | Fiscal Folio:</span> <span t-esc="tfd.get('UUID')"/>
                            </div>
                            <div class="digital-stamp-content text-center">
                                <strong>This document is a printed representation of a CFDI</strong>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </xpath>
        <xpath expr="//div[hasclass('page')]/div[6]" position="replace">
        </xpath>
    </template>
    <record id="l10n_mx_edi.report_invoice_document_mx" model="ir.ui.view">
        <field name="active" eval='False'/>
    </record>
</odoo>
