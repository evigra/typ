<?xml version="1.0" encoding="utf-8"?>
    <openerp>
        <data>
            <template id="report_electronic_invoice_document">
                <div class="page">
                    <t t-if="o">
                        <t t-value="set_global_data(o)"></t>
                        <t t-set="dict_data" t-value="set_dict_data(o)"></t>
                        <t t-set="extra_data" t-value="o.context_extra_data"></t>
                        <t t-set="dict_context_extra_data" t-value="eval(extra_data)"></t>
                        <t t-set="empty_dict" t-value="{}"></t>
                    </t>
                    <div class="row">
                        <div class="col-xs-3 text-center">
                            <img t-if="company.logo" t-att-src="'data:image/png;base64,%s' % company.logo" style="max-height: 60; max-width: auto;"/>
                        </div>
                        <div class="col-xs-offset-4 col-xs-5 text-right">
                            <div class="row" style="font-size: 12;">
                                <div class="col-xs-4 text-center bg-primary" style="border-top-left-radius: 0.4em; padding-top: 0.0em;">
                                    <t t-if="dict_context_extra_data.get('type', False) == 'out_invoice'"><span>Invoice:</span></t>
                                    <t t-if="dict_context_extra_data.get('type', False) == 'out_refund'"><span style="font-size:12px">Credit note</span></t>
                                    <t t-if="dict_context_extra_data.get('type', False) == 'payroll'"><span style="font-size:12px">Payroll</span></t>
                                </div>
                                <div class="col-xs-8 text-center bg-primary" style="border-top-right-radius: 0.4em; padding-top: 0.0em;">
                                    <span>Document Date</span>
                                </div>
                            </div>
                            <div class="row" style="border: 2px solid #deeff5; border-bottom-left-radius: 0.4em; border-bottom-right-radius: 0.4em;">
                                <div class="col-xs-4 text-center" style="padding-top: 0.0em; border-right: 2px solid #deeff5;">
                                    <h4 style="color:red;">
                                        <t t-if="dict_context_extra_data.get('type', False) in ['out_invoice', 'out_refund']">
                                            <t t-if="o.state in ['done', 'signed']">
                                                <strong t-esc="dict_data.get('@folio', '')"/>
                                            </t>
                                            <t t-if="not o.state in ['done', 'signed']">
                                                <strong>WITHOUT FOLIO OR INVALID STATUS</strong>
                                            </t>
                                        </t>
                                    </h4>
                                </div>
                                <div class="col-xs-8 text-center">
                                    <span t-esc="dict_data.get('@fecha', False) and datetime.strptime(dict_data.get('@fecha').encode('ascii','replace'), '%Y-%m-%dT%H:%M:%S').strftime('%d/%m/%Y %H:%M:%S') or ''"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" style="padding-top: 0.5em; font-size: 12;">
                        <div class="col-xs-5" style="padding-left: 0.0em; padding-right: 0.2em;">
                            <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                                <span>Fiscal Folio</span>
                            </div>
                        </div>
                        <div class="col-xs-4" style="padding-right: 0.2em; padding-left: 0.2em;">
                            <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                                <span>Fiscal Regime</span>
                            </div>
                        </div>
                        <div class="col-xs-3" style="padding-right: 0.0em; padding-left: 0.2em;">
                            <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                                <span>Issuer Certificate</span>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div>
                            <div class="col-xs-5" style="padding-left: 0.0em; padding-right: 0.2em;">
                                <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em; font-size: 10;">
                                    <span t-esc="dict_data.get('Complemento', {}).get('TimbreFiscalDigital').get('@UUID', 'No identificado')"/>
                                </div>
                            </div>
                            <div class="col-xs-4" style="padding-right: 0.2em; padding-left: 0.2em;">
                                <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em; font-size: 10;">
                                    <span t-esc="dict_data.get('Emisor', False) and dict_data.get('Emisor').get('RegimenFiscal', False) and dict_data.get('Emisor').get('RegimenFiscal').get('@Regimen', '')"/>
                                </div>
                            </div>
                            <div class="col-xs-3" style="padding-right: 0.0em; padding-left: 0.2em;">
                                <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em; font-size: 10;">
                                    <span t-esc="dict_data.get('@noCertificado', 'No identificado')"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" style="padding-top: 0.5em; font-size: 12;">
                        <div>
                            <div class="col-xs-6" style="padding-right: 0.2em; padding-left: 0.0em;">
                                <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                                    <span>Issuer</span>
                                </div>
                            </div>
                            <div class="col-xs-6" style="padding-right: 0.0em; padding-left: 0.2em;">
                                <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                                    <span>Customer</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div style="font-size: 10;">
                            <div class="col-xs-6" style="padding-right: 0.2em; padding-left: 0.0em;">
                                <div class="text-left" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em;">
                                    <t t-set="dom_fis" t-value="dict_data.get('Emisor', {}).get('DomicilioFiscal', {}) or {}"></t>
                                    <t t-set="emisor" t-value="dict_context_extra_data.get('emisor', {})"></t>
                                    <div>
                                        <strong><span t-esc="dict_data.get('Emisor', '') and dict_data.get('Emisor').get('@nombre', '') or ''"/></strong>
                                    </div>
                                    <div>
                                        <span t-esc="dom_fis.get('@calle', '')"/>
                                        <span t-esc="dom_fis.get('@noExterior', '')"/>
                                        <span t-esc="dom_fis.get('@noInterior', '')"/>
                                        <br/>
                                        <span t-esc="'Col. %s,' %(dom_fis.get('@colonia', ''))"/>
                                        <span t-esc="'CP. %s' % (dom_fis.get('@codigoPostal', ''))"/>
                                        <br/>
                                        <span t-esc="'%s, '%(dom_fis.get('@localidad', ''))"/>
                                        <br/>
                                        <span t-esc="'%s, '%(dom_fis.get('@municipio', ''))"/>
                                        <span t-esc="'%s, '%(dom_fis.get('@estado', ''))"/>
                                        <span t-esc="'%s, '%(dom_fis.get('@pais', ''))"/>
                                    </div>
                                    <div>
                                         <span t-if="emisor.get('phone', False)" t-esc="'Tel. %s'%(emisor.get('phone', ''))"/>
                                    </div>
                                    <div>
                                         <strong><span t-esc="'RFC. %s'%(dict_data.get('Emisor', '') and dict_data.get('Emisor').get('@rfc', ''))"/></strong>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-6" style="padding-right: 0.0em; padding-left: 0.2em;">
                                <div class="text-right" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em;">
                                    <t t-set="add_receptor" t-value="dict_data.get('Receptor', {}).get('Domicilio', {})"></t>
                                    <div>
                                        <strong><span t-esc="dict_data.get('Receptor', False) and dict_data.get('Receptor').get('@nombre', '')"/></strong>
                                    </div>
                                    <div>
                                        <span t-esc="add_receptor.get('@calle', False) and add_receptor.get('@calle', '')"/>
                                        <span t-esc="add_receptor.get('@noExterior', False) and 'No. Ext. %s, '%(add_receptor.get('@noExterior', ''))"/>
                                        <span t-esc="add_receptor.get('@noInterior', False) and 'No. Int.%s, '%(add_receptor.get('@noInterior', ''))"/>
                                        <br/>
                                        <span t-esc="add_receptor.get('@colonia', False) and '%s, '%(add_receptor.get('@colonia', ''))"/>
                                        <span t-esc="add_receptor.get('@codigoPostal', False) and 'CP. %s, '%(add_receptor.get('@codigoPostal', ''))"/>
                                        <br/>
                                        <span t-esc="add_receptor.get('@localidad', False) and '%s, '%(add_receptor.get('@localidad', ''))"/>
                                        <br/>
                                        <span t-esc="add_receptor.get('@municipio', False) and '%s, '%(add_receptor.get('@municipio', ''))"/>
                                        <span t-esc="add_receptor.get('@estado', False) and '%s, '%(add_receptor.get('@estado', ''))"/>
                                        <span t-esc="add_receptor.get('@pais', False) and add_receptor.get('@pais', '')"/>
                                    </div>
                                    <br/>
                                    <div>
                                        <strong><span t-esc="'RFC. %s' % (dict_data.get('Receptor', False) and dict_data.get('Receptor').get('@rfc', ''))"/></strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" style="font-size:10px; padding-top: 0.5em;">
                        <div class="col-xs-1 text-center bg-primary">
                            <span>Quantity</span>
                        </div>
                        <div class="col-xs-1 text-center bg-primary">
                            <span>Unit</span>
                        </div>
                        <div class="col-xs-7 text-center bg-primary">
                            <span>Description</span>
                        </div>
                        <div class="col-xs-1 text-center bg-primary">
                            <span>Unit Price</span>
                        </div>
                        <div class="col-xs-2 text-center bg-primary">
                            <span>Amount</span>
                        </div>
                    </div>
                    <div class="row">
                        <table class="table table-striped" style="font-size:9px; border-collapse: collapse;">
                            <t t-set="dict_lines" t-value="dict_data.get('Conceptos', {}).get('Concepto', ())"/>
                            <t t-if="not isinstance(dict_lines, list)">
                                <t t-set="dict_lines" t-value="[dict_lines]"/>
                            </t>
                            <t t-foreach="range(0,len(dict_lines))" t-as="dicto">
                                <tr class="text-center">
                                    <td class="col-xs-1 text-right"><span t-esc="formatLang(float(dict_lines[dicto].get('@cantidad', '0.0')),digits=0, grouping=True)"></span></td>
                                    <td class="col-xs-1 text-left"><span t-esc="dict_lines[dicto].get('@unidad', '0.0')"></span></td>
                                    <td class="col-xs-7 text-left"><span t-esc="dict_lines[dicto].get('@descripcion', '0.0')"></span></td>
                                    <td class="col-xs-1 text-right"><span t-esc="formatLang(float(dict_lines[dicto].get('@valorUnitario', '0.0')),digits=4, grouping=True)"></span></td>
                                    <td class="col-xs-2 text-right"><span t-esc="formatLang(float(dict_lines[dicto].get('@importe', '0.0')),digits=2, grouping=True)"></span></td>
                                </tr>
                            </t>
                        </table>
                    </div>
                    <div class="row">
                        <div class="row col-xs-offset-9 col-xs-3">
                            <table class="col-xs-12" style="font-size:10px">
                                <tr>
                                    <th class="text-left" style="border-top: solid 1.5px #5689bc;"><span>Sub Total</span></th>
                                    <td class="text-right" style="border-top: solid 1.5px #5689bc;"><span t-esc="formatLang(float(dict_data.get('@subTotal', '0.0')),digits=2, grouping=True)"/></td>
                                </tr>
                                <t t-set="desc_amount" t-value="float(dict_data.get('@descuento', False))"/>
                                <t t-if="desc_amount > 0">
                                    <tr>
                                        <th class="text-left" style="border-top: solid 1.5px #5689bc;"><span>Discount</span></th>
                                        <td class="text-right" style="border-top: solid 1.5px #5689bc;"><span t-esc="formatLang(float(dict_data.get('@descuento', '0.0')),digits=2, grouping=True)"/></td>
                                    </tr>
                                </t>
                                <t t-if="dict_data.get('Impuestos', {}).has_key('Traslados')">
                                    <t t-set="dict_imp" t-value="dict_data.get('Impuestos', {}).get('Traslados', {}).get('Traslado', False)"/>
                                    <t t-if="not isinstance(dict_imp, list)">
                                        <t t-set="dict_imp" t-value="[dict_data.get('Impuestos', {}).get('Traslados', {}).get('Traslado', False)]"/>
                                    </t>
                                    <t t-foreach="range(0,len(dict_imp))" t-as="imp">
                                        <t t-set="imp_amount" t-value="float(dict_imp[imp].get('@importe', False))"/>
                                        <t t-if="imp_amount > 0">
                                            <tr>
                                                <th class="text-left" style="border-top: solid 1.5px #5689bc;">
                                                <t t-set="imp_name" t-value="dict_imp[imp].get('@impuesto', False)"/>
                                                <t t-set="tasa" t-value="dict_imp[imp].get('@tasa', False)"/>
                                                <t t-set="text" t-value="imp_name+' ('+tasa+') %'"/>
                                                <span t-esc="text or '0.0'"/> </th>
                                                <td class="text-right" style="border-top: solid 1.5px #5689bc;">
                                                    <t t-set="importe" t-value="dict_imp[imp].get('@importe', False)"/>
                                                    <span t-esc="formatLang(float(importe or '0.0'),digits=2, grouping=True)"/>
                                                </td>
                                            </tr>
                                        </t>
                                    </t>
                                </t>
                                <t t-if="dict_data.get('Impuestos', {}).has_key('Retenciones')">
                                    <t t-set="dict_ret" t-value="dict_data.get('Impuestos', {}).get('Retenciones', {}).get('Retencion', False)"/>
                                    <t t-if="not isinstance(dict_ret, list)">
                                        <t t-set="dict_ret" t-value="[dict_data.get('Impuestos', {}).get('Retenciones', {}).get('Retencion', False)]"/>
                                    </t>
                                    <t t-foreach="range(0,len(dict_ret))" t-as="ret">
                                        <t t-set="ret_amount" t-value="float(dict_ret[ret].get('@importe', False))"/>
                                        <t t-if="ret_amount > 0">
                                            <tr style="padding-top: 0.3em; padding-bottom: 0.3em;">
                                                <th class="text-left" style="border-top: solid 1.5px #5689bc;">
                                                <t t-set="ret_name" t-value="dict_ret[ret].get('@impuesto', '')"/>
                                                <span t-esc="_('Ret. %s' % (ret_name or '' ))"/> </th>
                                                <td class="text-right" style="border-top: solid 1.5px #5689bc;">
                                                    <span t-esc="formatLang(float(ret_amount or '0.0'),digits=2, grouping=True)"/>
                                                </td>
                                            </tr>
                                        </t>
                                    </t>
                                </t>
                                <tr align="left">
                                    <th class="text-left" style="border-top: solid 1.5px #5689bc;"><b><span t-esc="_('Total')"/></b></th>
                                    <td class="text-right" align="right" style="border-top: solid 1.5px #5689bc;"><b><span t-esc="formatLang(float(dict_data.get('@total', '0.0')),digits=2, grouping=True)"/></b></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="row" style="font-size: 10;">
                        <div class="col-xs-12">
                            <span>Amount In Letters</span>
                        </div>
                        <div class="col-xs-12 text-center">
                            <span t-esc="'*( %s )*' % (amount_to_text(float(dict_data.get('@total', '').encode('ascii','replace')),dict_data.get('@Moneda', '')))"></span>
                        </div>
                        <div class="col-xs-12 text-center">
                            <span t-esc="_('PAGO EN UNA SOLA EXHIBICIÓN - EFECTOS FISCALES AL PAGO')"/>
                        </div>
                        <div class="col-xs-12">
                            <t t-if="dict_context_extra_data.get('payment_term', '')">
                                <strong>Terms and Conditions:</strong><span t-esc="dict_context_extra_data.get('payment_term', '')"/>
                            </t>
                            <t t-if="dict_context_extra_data.get('comment', '')">
                                <strong>Additional Comments:</strong><span t-esc="dict_context_extra_data.get('comment', '')"/>
                            </t>
                        </div>
                        <div class="col-xs-12">
                            <span t-esc="get_text_promissory(o.model_source, o.id_source)"/>
                        </div>
                    </div>
                    <div class="row" style="padding-top: 0.5em; font-size: 12;">
                        <div>
                            <div class="col-xs-4" style="padding-left: 0.0em; padding-right: 0.2em;">
                                <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                                    <span>Payment Method</span>
                                </div>
                            </div>
                            <div class="col-xs-4" style="padding-left: 0.2em; padding-right: 0.2em;">
                                <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                                    <span>Date Stamp</span>
                                </div>
                            </div>
                            <div class="col-xs-4" style="padding-left: 0.2em; padding-right: 0.0em;">
                                <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em;">
                                    <span>SAT Certificate</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div>
                            <div class="col-xs-4" style="padding-left: 0.0em; padding-right: 0.2em;">
                                <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em;">
                                    <span t-esc="dict_data.get('@metodoDePago', 'No identificado')"/>
                                </div>
                            </div>
                            <div class="col-xs-4" style="padding-left: 0.2em; padding-right: 0.2em;">
                                <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em;">
                                    <span t-esc="'%s' % dict_data.get('Complemento', {}).get('TimbreFiscalDigital', {}).get('@FechaTimbrado', False) and datetime.strptime(dict_data.get('Complemento', {}).get('TimbreFiscalDigital', {}).get('@FechaTimbrado').encode('ascii','replace'), '%Y-%m-%dT%H:%M:%S').strftime('%d/%m/%Y %H:%M:%S') or 'No identificado'"/>
                                </div>
                            </div>
                            <div class="col-xs-4" style="padding-left: 0.2em; padding-right: 0.0em;">
                                <div class="text-center" style="border-bottom-right-radius: 0.4em; border-bottom-left-radius: 0.4em; border: 2px solid #deeff5; padding-top: 0.0em;">
                                    <span t-esc="dict_data.get('Complemento', empty_dict).get('TimbreFiscalDigital', empty_dict).get('@noCertificadoSAT', 'No identificado')"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row" style="padding-top: 0.5em;">
                        <div class="col-xs-12 img-rounded" style="border: 2px solid #deeff5; padding-left: 0.0em; padding-right: 0.0em;">
                            <div class="text-center bg-primary" style="border-top-right-radius: 0.4em; border-top-left-radius: 0.4em; padding-top: 0.0em; font-size: 12;">
                                <span>Place, date and time of issue</span>
                            </div>
                            <div class="text-center" style="font-size: 7pt;">
                                <t t-set="address" t-value="dict_data.get('Emisor', {}).get('ExpedidoEn', {}) or {}"></t>
                                <span t-esc="dict_data.get('Emisor', '') and dict_data.get('Emisor').get('@nombre', '') or ''"/>
                                <br/>
                                <span t-esc="address.get('@calle', '')"/>
                                <span t-esc="address.get('@noExterior', '')"/>
                                <span t-esc="address.get('@noInterior', '')"/>
                                <br/>
                                <span t-esc="address.get('@colonia', '')"/>
                                <span t-esc="_('ZIP')"/><span t-esc="address.get('@codigoPostal', '')"/>
                                <br/>
                                <span t-esc="_('Locality')"/><span t-esc="address.get('@localidad', '')"/>
                                <br/>
                                <span t-esc="address.get('@municipio', '')"/>
                                <span t-esc="address.get('@estado', '')"/>
                                <span t-esc="address.get('@pais', '')"/>
                                <br/>
                                <span t-esc="dict_data.get('@fecha', False) and datetime.strptime(dict_data.get('@fecha').encode('ascii','replace'), '%Y-%m-%dT%H:%M:%S').strftime('%d/%m/%Y %H:%M:%S') or ''"/>
                            </div>
                        </div>
                    </div>
                    <div class="row" style="padding-top: 0.5em;">
                        <div class="col-xs-12 img-rounded" style="page-break-inside:avoid; border: 2px solid #deeff5;">
                            <div class="col-xs-3" style="float:left; padding-top: 0.3em; padding-bottom: 0.3em;">
                                <t t-set="img" t-value="create_qrcode(dict_data.get('Emisor', {}).get('@rfc', ''), dict_data.get('Receptor', {}).get('@rfc', ''), float(dict_data.get('@total', '').encode('ascii','replace')), dict_data.get('Complemento', {}).get('TimbreFiscalDigital', {}).get('@UUID', ''))"/>
                                <img t-if="img" t-att-src="'data:image/png;base64,%s' % img" style="max-height: 180; max-width: 180;"/>
                            </div>
                            <div class="col-xs-9" style="font-size:8px">
                                <br/>
                                <div style="padding-top: 0.3em; padding-bottom: 0.3em;">
                                    <strong>Digital Stamp Issuer</strong>
                                </div>
                                <div style="padding-top: 0.3em; padding-bottom: 0.3em;">
                                    <span t-esc="split_string( dict_data.get('@sello', ''))"/>
                                </div>
                                <div style="padding-top: 0.3em; padding-bottom: 0.3em;">
                                    <strong>Digital Stamp SAT</strong>
                                </div>
                                <div style="padding-top: 0.3em; padding-bottom: 0.3em;">
                                    <span t-esc="split_string( dict_data.get('Complemento', empty_dict).get('TimbreFiscalDigital', empty_dict).get('@selloSAT', ''))"/>
                                </div>
                                <div style="padding-top: 0.3em; padding-bottom: 0.3em;">
                                    <strong>Original String</strong>
                                </div>
                                <div style="padding-top: 0.3em; padding-bottom: 0.3em;">
                                    <span t-esc="split_string( o.cfdi_cadena_original ) or ''"/>
                                </div>
                                <div style="padding-top: 0.3em; padding-bottom: 0.3em;">
                                    <strong>Certificate Link</strong>
                                </div>
                                <div style="padding-top: 0.3em; padding-bottom: 0.3em;">
                                    <span t-esc="split_string( o.certificate_link) or ''"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            <p style="page-break-after:always"></p>
        </template>

        <template id="report_electronic_invoice">
            <t t-foreach="doc_ids" t-as="doc_id">
                <t t-raw="translate_doc(doc_id, doc_model, 'company_id.partner_id.lang','typ.report_electronic_invoice_document')"/>
            </t>
        </template>
    </data>
</openerp>
